title: 作用域链和标识符详细解析
date: 2015-07-31 13:42:30
tags: 高性能JavaScript学习笔记
categories: 作用域链和标识符详细解析
---

　　每一个 JavaScript 函数都被表示为对象。进一步说，它是一个函数实例。函数对象正如其他对象那样，拥有你可以编程访问的属性，和一系列不能被程序访问，仅供 JavaScript 引擎使用的内部属性。其中一个内部属性是[[Scope]]，由 ECMA-262 标准第三版定义。
<!--more-->
　　内部[[Scope]]属性包含一个函数被创建的作用域中对象的集合。此集合被称为函数的作用域链，它决定哪些数据可由函数访问。此函数作用域链中的每个对象被称为一个可变对象，每个可变对象都以“键值对”的形式存在。当一个函数创建后，它的作用域链被填充以对象，这些对象代表创建此函数的环境中可访问的数据。例如下面这个全局函数：

	function add(num1, num2){
		var sum = num1 + num2;
		return sum;
	}
　　当 add()函数创建后，它的作用域链中填入一个单独的可变对象，此全局对象代表了所有全局范围定义的变量。此全局对象包含诸如窗口、浏览器和文档之类的访问接口。下图指出了它们之间的关系（注意：此图中只画出全局变量中很少的一部分，其他部分还很多）。
![add()函数的作用域链](http://7xkj1z.com1.z0.glb.clouddn.com/作用域链img-1.png "add()函数的作用域链")
add 函数的作用域链将会在运行时用到。假设运行下面的代码：

	var total = add(5, 10);
　　运行此 add 函数时建立一个内部对象，称作“运行期上下文”。一个运行期上下文定义了一个函数运行时的环境。对函数的每次运行而言，每个运行期上下文都是独一的，所以多次调用同一个函数就会导致多次创建运行期上下文。当函数执行完毕，运行期上下文就被销毁。

　　一个运行期上下文有它自己的作用域链，用于标识符解析。当运行期上下文被创建时，它的作用域链被初始化，连同运行函数的[[Scope]]属性中所包含的对象。这些值按照它们出现在函数中的顺序，被复制到运行期上下文的作用域链中。这项工作一旦完成，一个被称作“激活对象”的新对象就为运行期上下文创建好了。此激活对象作为函数执行期的一个可变对象，包含访问所有局部变量，命名参数，参数集合，和 this 的接口。然后，此对象被推入作用域链的前端。当作用域链被销毁时，激活对象也一同销毁。下图显示了前面实例代码所对应的运行期上下文和它的作用域链。
![运行 add()时的作用域链](http://7xkj1z.com1.z0.glb.clouddn.com/作用域链img-2.png "运行 add()时的作用域链")
　　在函数运行过程中，每遇到一个变量，标识符识别过程要决定从哪里获得或者存储数据。此过程搜索运行期上下文的作用域链，查找同名的标识符。搜索工作从运行函数的激活目标之作用域链的前端开始。如果找到了，那么就使用这个具有指定标识符的变量；如果没找到，搜索工作将进入作用域链的下一个对象。此过程持续运行，直到标识符被找到，或者没有更多对象可用于搜索，这种情况下标识符将被认为是未定义的。函数运行时每个标识符都要经过这样的搜索过程，例如前面的例子中，函数访问 sum，num1，num2 时都会产生这样的搜索过程。

---
以上就是作用域链的详细工作过程和原理。